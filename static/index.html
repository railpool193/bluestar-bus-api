<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bluestar Bus ‚Äì meg√°ll√≥ & j√°rat keres≈ë</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #9ca3af;
      --ok: #22c55e;
      --bad: #ef4444;
      --acc: #10b981;
      --txt: #e5e7eb;
    }
    html,body{background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; margin:0}
    .wrap{max-width:900px;margin:40px auto;padding:0 16px}
    .title{font-size:clamp(24px,4vw,40px);font-weight:800;display:flex;gap:.6rem;align-items:center}
    .bus{font-size:32px}
    .card{background:linear-gradient(180deg,#0b1222,#0a0f1a);border:1px solid #1f2937;border-radius:16px;padding:18px 18px 8px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input[type=text]{flex:1;min-width:220px;background:#0b1222;color:var(--txt);
      border:1px solid #1f2937;border-radius:10px;padding:12px 14px;font-size:16px;outline: none}
    button{background:var(--acc);color:#06281e;border:0;border-radius:12px;padding:12px 18px;
      font-weight:700;cursor:pointer;box-shadow:0 0 0 0 rgba(16,185,129,.6);transition:.2s}
    button:hover{transform:translateY(-1px)}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:.5rem;vertical-align:middle}
    .ok{background:var(--ok)} .bad{background:var(--bad)}
    .hint{color:var(--muted);margin:10px 2px 0}
    .list{margin-top:14px;border-top:1px solid #1f2937}
    .pill{display:inline-block;background:#0b1222;border:1px solid #1f2937;border-radius:999px;
      padding:6px 10px;margin:8px 8px 0 0;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:12px 8px;border-bottom:1px solid #1f2937;text-align:left}
    th{color:#cbd5e1;font-weight:700}
    .liveDot{display:inline-block;width:8px;height:8px;border-radius:999px;background:#22c55e}
    .muted{color:#9ca3af}
    .footer{opacity:.8;text-align:center;margin:28px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title"><span class="bus">üöå</span> Bluestar Bus ‚Äì meg√°ll√≥ & j√°rat keres≈ë</div>

    <div class="card">
      <div class="row">
        <input id="q" type="text" placeholder="√çrj be meg√°ll√≥nevet (pl. Hanover, Shirley‚Ä¶)" />
        <button id="go">Keres√©s</button>
      </div>

      <div class="row" style="gap:18px;margin-top:10px">
        <div><span id="apiDot" class="dot bad"></span>API</div>
        <div><span id="gtfsDot" class="dot bad"></span>GTFS</div>
        <div><span id="liveDot" class="dot bad"></span>Live</div>
      </div>

      <div id="multiWrap" class="list" style="display:none">
        <div class="hint">T√∂bb meg√°ll√≥ illeszkedik. V√°lassz egyet:</div>
        <div id="multi"></div>
      </div>

      <div id="resWrap" class="list" style="display:none">
        <div id="stopTitle" class="hint"></div>
        <table>
          <thead>
            <tr><th>J√°rat</th><th>C√©l</th><th>Indul√°s</th><th>√âl≈ë</th></tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </div>

    <div class="footer">UI & API: te ‚Äì ‚ù§Ô∏è</div>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);
    const api = (p, opt={}) => fetch(p, opt).then(r => r.json());

    // st√°tusz
    async function refreshStatus(){
      try{
        const s = await api('/api/status');
        $('#apiDot').className = 'dot ok';
        $('#gtfsDot').className = 'dot ' + (s.gtfs ? 'ok' : 'bad');
        $('#liveDot').className = 'dot ' + (s.live ? 'ok' : 'bad');
      }catch(_){
        $('#apiDot').className = 'dot bad';
        $('#gtfsDot').className = 'dot bad';
        $('#liveDot').className = 'dot bad';
      }
    }
    refreshStatus();

    // keres√©s
    async function search(){
      const q = $('#q').value.trim();
      if(q.length < 2){
        alert('√çrj be legal√°bb 2 karaktert.');
        return;
      }
      const stops = await api('/api/stops/search?q='+encodeURIComponent(q));
      $('#rows').innerHTML = '';
      $('#resWrap').style.display = 'none';
      const mw = $('#multi'), mwrap = $('#multiWrap');
      mw.innerHTML = '';
      mwrap.style.display = 'none';

      if(!stops.length){
        alert('Nincs tal√°lat erre a n√©vre.');
        return;
      }
      if(stops.length === 1){
        loadStop(stops[0].stop_id, stops[0].stop_name);
        return;
      }
      // t√∂bb tal√°lat: lista
      mwrap.style.display = 'block';
      stops.slice(0, 30).forEach(s => {
        const b = document.createElement('span');
        b.className = 'pill';
        b.textContent = `${s.stop_name} ‚Ä¢ (${s.stop_id})`;
        b.onclick = () => loadStop(s.stop_id, s.stop_name);
        mw.appendChild(b);
      });
    }

    async function loadStop(stopId, stopName){
      $('#multiWrap').style.display = 'none';
      $('#rows').innerHTML = '';
      $('#resWrap').style.display = 'block';
      $('#stopTitle').textContent = `Meg√°ll√≥: ${stopName} ‚Ä¢ (${stopId})`;

      const data = await api(`/api/stops/${encodeURIComponent(stopId)}/next_departures?minutes=60`);
      const tbody = $('#rows');
      if(!data.results || !data.results.length){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="muted" colspan="4">Nincs k√∂zelg≈ë indul√°s.</td>`;
        tbody.appendChild(tr);
        return;
      }
      data.results.forEach(r => {
        const t = new Date(r.time_iso);
        const hh = String(t.getHours()).padStart(2,'0');
        const mm = String(t.getMinutes()).padStart(2,'0');
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.route || '-'}</td>
          <td>${r.destination || '-'}</td>
          <td>${hh}:${mm}</td>
          <td>${r.is_live ? '<span class="liveDot"></span>' : '‚Äì'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    $('#go').onclick = search;
    $('#q').addEventListener('keydown', e => { if(e.key === 'Enter') search(); });
  </script>
</body>
</html>
