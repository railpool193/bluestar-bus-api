<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluestar Bus ‚Äì meg√°ll√≥ & j√°rat keres≈ë</title>
    <style>
        body { background: #111; color: #fff; font-family: Arial, sans-serif; text-align: center; }
        .card { background: #222; padding: 20px; margin: 20px auto; border-radius: 12px; max-width: 500px; }
        input { width: 80%; padding: 10px; border-radius: 8px; border: none; }
        button { padding: 10px 20px; border-radius: 8px; background: green; color: white; border: none; cursor: pointer; margin-top: 10px; }
        .status { margin-top: 10px; }
        .dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        .green { background-color: #00ff00; }
        .red { background-color: #ff0000; }
        .stop { padding: 8px; margin: 6px; background: #333; border-radius: 6px; cursor: pointer; }
        .departures { margin-top: 15px; }
    </style>
</head>
<body>
    <h1>üöå Bluestar Bus ‚Äì meg√°ll√≥ & j√°rat keres≈ë</h1>
    <div class="card">
        <input type="text" id="query" placeholder="√çrd be a meg√°ll√≥ nev√©t...">
        <button onclick="searchStops()">Keres√©s</button>
        <div class="status">
            <span class="dot" id="api"></span> API
            <span class="dot" id="gtfs"></span> GTFS
            <span class="dot" id="live"></span> Live
        </div>
        <div id="results"></div>
        <div class="departures" id="departures"></div>
    </div>

    <script>
        async function checkStatus() {
            let res = await fetch('/api/status');
            let data = await res.json();
            document.getElementById("api").className = "dot " + (data.status === "ok" ? "green" : "red");
            document.getElementById("gtfs").className = "dot " + (data.gtfs ? "green" : "red");
            document.getElementById("live").className = "dot " + (data.live ? "green" : "red");
        }

        async function searchStops() {
            let q = document.getElementById("query").value;
            let res = await fetch(`/api/stops/search?q=${q}`);
            let data = await res.json();
            let resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";

            if (data.length === 0) {
                resultsDiv.innerHTML = "<p>Nincs tal√°lat.</p>";
                return;
            }

            if (data.length > 1) {
                resultsDiv.innerHTML = "<p>T√∂bb meg√°ll√≥ is van erre a n√©vre. V√°lassz egyet:</p>";
                data.forEach(stop => {
                    let div = document.createElement("div");
                    div.className = "stop";
                    div.textContent = stop.stop_name;
                    div.onclick = () => getDepartures(stop.stop_id, stop.stop_name);
                    resultsDiv.appendChild(div);
                });
            } else {
                getDepartures(data[0].stop_id, data[0].stop_name);
            }
        }

        async function getDepartures(stop_id, stop_name) {
            let res = await fetch(`/api/departures/${stop_id}`);
            let data = await res.json();
            let depDiv = document.getElementById("departures");
            depDiv.innerHTML = `<h3>${stop_name} ‚Äì indul√°sok</h3>`;
            if (data.departures.length === 0) {
                depDiv.innerHTML += "<p>Nincs √©l≈ë adat.</p>";
            } else {
                data.departures.forEach(dep => {
                    depDiv.innerHTML += `<p>${dep.line} ‚Üí ${dep.destination} (${dep.time})</p>`;
                });
            }
        }

        checkStatus();
    </script>
</body>
</html>
