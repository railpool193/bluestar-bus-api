<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bluestar Bus – Live Departures</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #161a22;
      --text: #e6e9ef;
      --muted: #9aa4b2;
      --accent: #8b5cf6;
      --good: #10b981;
      --bad: #ef4444;
      --line: #232838;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, #1a2030, #0f1115);
      color: var(--text);
    }
    header {
      padding: 24px 20px;
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent);
    }
    .title {
      font-weight: 700;
      letter-spacing: .2px;
      display: flex; align-items: center; gap: 10px;
    }
    .title .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--good); box-shadow: 0 0 14px var(--good);
      display: inline-block;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 120px 120px auto;
      gap: 10px;
      width: min(100%, 760px);
      align-items: center;
    }
    input, select, button {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: #0e121a;
      color: var(--text);
      outline: none;
    }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(139,92,246,.25); }
    button {
      background: var(--accent);
      border: none;
      cursor: pointer;
      font-weight: 600;
    }
    button.secondary { background: #0e121a; border: 1px solid var(--line); }
    .quick {
      display: flex; gap: 8px; flex-wrap: wrap;
      margin: 12px 20px 0 20px;
    }
    main { padding: 20px; }
    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 0;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .card header {
      padding: 14px 16px;
      border: none;
      background: linear-gradient(180deg, rgba(139,92,246,.15), rgba(139,92,246,.03));
    }
    .meta { color: var(--muted); font-size: 14px; }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px 14px;
      border-top: 1px solid var(--line);
      text-align: left;
      font-size: 15px;
    }
    th { color: var(--muted); font-weight: 600; background: #111521; }
    tr:hover td { background: #121826; }
    .right { text-align: right; }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, Menlo, Consolas, monospace; }
    .status { margin-left: 10px; color: var(--muted); font-size: 14px; }
    .error { color: var(--bad); }
    footer {
      color: var(--muted);
      font-size: 13px; padding: 16px 20px 40px;
    }
    @media (max-width: 720px) {
      .controls { grid-template-columns: 1fr 100px 100px auto; }
      th:nth-child(3), td:nth-child(3) { display:none; } /* hide destination on small screens */
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <span class="dot" aria-hidden="true"></span>
      <div>
        <div>Bluestar Bus – Live Departures</div>
        <div class="meta">Lightweight UI on top of your FastAPI backend</div>
      </div>
    </div>
    <div class="controls">
      <input id="stopId" placeholder="Stop ID, e.g. 1980SN12619E" />
      <input id="minutes" type="number" min="1" max="240" value="60" />
      <select id="endpoint">
        <option value="generic">/next_departures/{stop_id}</option>
        <option value="ck">/vincents-walk/ck</option>
        <option value="cm">/vincents-walk/cm</option>
      </select>
      <button id="loadBtn">Load</button>
    </div>
  </header>

  <div class="quick">
    <button class="secondary" data-preset="ck">Vincents Walk (ck)</button>
    <button class="secondary" data-preset="cm">Vincents Walk (cm)</button>
    <button class="secondary" data-preset="generic">Use Stop ID (generic)</button>
    <span class="status" id="status">Idle</span>
  </div>

  <main>
    <div class="card">
      <header>
        <div>
          <strong id="title">Departures</strong>
          <span class="meta" id="subtitle"></span>
        </div>
      </header>
      <div style="overflow:auto;">
        <table id="table">
          <thead>
            <tr>
              <th style="width: 100px;">Route</th>
              <th>Departure</th>
              <th>Destination</th>
              <th class="right">Time</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr><td colspan="4" class="meta" style="padding:18px;">No data yet.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <footer>
    Tippek: bármikor használhatod a <span class="mono">/docs</span> oldalt próbakéréshez.  
    Ez az oldal 30 másodpercenként automatikusan frissít.
  </footer>

  <script>
    const stopIdEl  = document.getElementById('stopId');
    const minutesEl = document.getElementById('minutes');
    const endpointEl= document.getElementById('endpoint');
    const btn       = document.getElementById('loadBtn');
    const statusEl  = document.getElementById('status');
    const titleEl   = document.getElementById('title');
    const subEl     = document.getElementById('subtitle');
    const tbody     = document.getElementById('tbody');

    // Defaults you likely use a lot
    const DEFAULT_STOP = '1980SN12619E';

    // build URL for fetch based on selector
    function buildUrl() {
      const minutes = Math.max(1, Number(minutesEl.value) || 60);
      const ep = endpointEl.value;
      if (ep === 'ck')  return `/vincents-walk/ck?minutes=${minutes}`;
      if (ep === 'cm')  return `/vincents-walk/cm?minutes=${minutes}`;
      // generic
      const stop = (stopIdEl.value || DEFAULT_STOP).trim();
      return `/next_departures/${encodeURIComponent(stop)}?minutes=${minutes}`;
    }

    function setStatus(text, isError=false) {
      statusEl.textContent = text;
      statusEl.classList.toggle('error', !!isError);
    }

    function render(data) {
      // title + subtitle
      titleEl.textContent = 'Departures';
      subEl.textContent = ` – stop ${data.stop_id}, next ${data.minutes} min`;

      // rows
      const rows = (data.departures || []).map(d => {
        return `
          <tr>
            <td class="mono">${d.route}</td>
            <td class="mono">${d.departure_time}</td>
            <td>${d.destination}</td>
            <td class="right mono">${d.departure_time}</td>
          </tr>`;
      }).join('');

      tbody.innerHTML = rows || `<tr><td colspan="4" class="meta" style="padding:18px;">No departures in this window.</td></tr>`;
    }

    async function loadOnce() {
      try {
        setStatus('Loading…');
        const url = buildUrl();
        const res = await fetch(url, { headers: { 'Accept': 'application/json' }});
        if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
        const data = await res.json();
        render(data);
        setStatus('OK');
      } catch (err) {
        console.error(err);
        setStatus(`Error: ${err.message}`, true);
      }
    }

    // UI events
    btn.addEventListener('click', loadOnce);
    document.querySelectorAll('.quick button').forEach(b => {
      b.addEventListener('click', () => {
        const p = b.dataset.preset;
        if (p === 'ck' || p === 'cm') {
          endpointEl.value = p;
        } else {
          endpointEl.value = 'generic';
          stopIdEl.value = DEFAULT_STOP;
        }
        loadOnce();
      });
    });

    // Auto refresh every 30s
    let timer = null;
    function startAuto() {
      if (timer) clearInterval(timer);
      timer = setInterval(loadOnce, 30000);
    }

    // Initial state
    stopIdEl.value = DEFAULT_STOP;
    endpointEl.value = 'generic';
    loadOnce();
    startAuto();
  </script>
</body>
</html>
